
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>êµ° ê´€ì œ ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        .alert { background-color: #ffcccc; }
        .report-box { margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
    </style>
    <script>
        const locations = [...Array(26)].map((_, i) => "ë¶€ëŒ€ " + String.fromCharCode(65 + i));
        const reasons = ["ì •ì „", "í¬íŠ¸ ë¬¸ì œ", "ë„¤íŠ¸ì›Œí¬ í˜¼ì¡", "ê¸°íƒ€"];
        
    let phonebook = {

            "ë¶€ëŒ€ A": [{name: "ê¹€ìƒì‚¬", phone: "010-1111-2222"}, {name: "ë°•ì¤‘ì‚¬", phone: "010-3333-4444"}],
            "ë¶€ëŒ€ B": [{name: "ì´ì†Œìœ„", phone: "010-5555-6666"}],
            "ë¶€ëŒ€ C": [{name: "ìµœëŒ€ìœ„", phone: "010-7777-8888"}, {name: "ì¥ì†Œë ¹", phone: "010-9999-0000"}],
        };

        let logs = [];

        function getRandomLog() {
            const now = new Date().toLocaleString();
            const location = locations[Math.floor(Math.random() * locations.length)];
            const prediction = Math.random() < 0.25 ? 1 : 0;
            return { timestamp: now, location, prediction, report: "", reason: "" };
        }

        function updateLogs() {
            logs.push(getRandomLog());
            renderLogs();
        }

        function renderLogs() {
            const onlyAlert = document.getElementById("only-alert").checked;
            const keyword = document.getElementById("search-location").value;
            const tbody = document.getElementById("log-body");
            tbody.innerHTML = "";

            logs.slice().reverse().forEach(log => {
                if (onlyAlert && log.prediction !== 1) return;
                if (keyword && !log.location.includes(keyword)) return;

                const highlight = log.prediction === 1 ? " class='alert'" : "";
                const report = log.report ? `<br><small>ğŸ“± ${log.report} (ì‚¬ìœ : ${log.reason})</small>` : "";

                tbody.innerHTML += `<tr${highlight}>
                    <td>${log.timestamp}</td>
                    <td>${log.location}</td>
                    <td>${log.prediction}${report}</td>
                </tr>`;
            });
        }

        function reportIssue() {
            const unit = document.getElementById("report-location").value;
            const text = document.getElementById("report-text").value;
            const reason = document.getElementById("report-reason").value;

            for (let i = logs.length - 1; i >= 0; i--) {
                if (logs[i].location === unit && logs[i].prediction === 1 && !logs[i].report) {
                    logs[i].report = text;
                    logs[i].reason = reason;
                    break;
                }
            }
            renderLogs();
            alert("ğŸ“± ê´€ì œ ë³´ê³ ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            document.getElementById("report-text").value = "";
        }

        
    function updatePhonebook() {

            const unit = document.getElementById("report-location").value;
            const box = document.getElementById("phonebook-list");
            box.innerHTML = "";

            if (phonebook[unit]) {
                phonebook[unit].forEach(entry => {
                    
    const duty = entry.duty ? " (ë‹¹ì§ì)" : "";
    box.innerHTML += `<li>${entry.name}: ${entry.phone}${duty}</li>`;

                });
            } else {
                box.innerHTML = "<li>ë“±ë¡ëœ ê°„ë¶€ ì •ë³´ ì—†ìŒ</li>";
            }
        }

        function downloadCSV() {
            let csv = "timestamp,location,prediction,report,reason\n";
            logs.forEach(l => {
                csv += `${l.timestamp},${l.location},${l.prediction},${l.report},${l.reason}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "ê´€ì œë¡œê·¸.csv";
            link.click();
        }

        setInterval(updateLogs, 5000);
        window.onload = () => {
            for (let i = 0; i < 10; i++) updateLogs();

            const unitSelect = document.getElementById("report-location");
            locations.forEach(loc => {
                const opt = document.createElement("option");
                opt.value = loc;
                opt.text = loc;
                unitSelect.appendChild(opt);
            });

            const reasonSelect = document.getElementById("report-reason");
            reasons.forEach(r => {
                const opt = document.createElement("option");
                opt.value = r;
                opt.text = r;
                reasonSelect.appendChild(opt);
            });

            updatePhonebook();
        };
    
    function editPhonebookEntry() {
        const unit = document.getElementById("report-location").value;
        const name = document.getElementById("edit-name").value.trim();
        const phone = document.getElementById("edit-phone").value.trim();
        const duty = document.getElementById("edit-duty").checked;

        if (!unit || !name || !phone) {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        if (!phonebook[unit]) phonebook[unit] = [];

        const existing = phonebook[unit].find(p => p.name === name);
        if (existing) {
            existing.phone = phone;
            existing.duty = duty;
        } else {
            phonebook[unit].push({ name, phone, duty });
        }

        updatePhonebook();
        alert("ê°„ë¶€ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        document.getElementById("edit-name").value = "";
        document.getElementById("edit-phone").value = "";
        document.getElementById("edit-duty").checked = false;
    }
    </script>

</head>
<body>
    <h1>ğŸ¯ êµ° ê´€ì œ ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</h1>
    <label><input type="checkbox" id="only-alert" onchange="renderLogs()"> ê´€ì œ ë¡œê·¸ë§Œ ë³´ê¸°</label>
    <input type="text" id="search-location" oninput="renderLogs()" placeholder="ë¶€ëŒ€ëª… ê²€ìƒ‰">
    <button onclick="downloadCSV()">CSV ì €ì¥</button>

    <div class="report-box">
        <h3>ğŸ“± ê´€ì œ ë³´ê³  ë“±ë¡</h3>
        <label>ë¶€ëŒ€:
            <select id="report-location" onchange="updatePhonebook()"></select>
        </label><br>
        <label>ì˜ˆìƒ ì‚¬ìœ :
            <select id="report-reason"></select>
        </label><br>
        <label>ë³´ê³  ë‚´ìš©:<br>
            <textarea id="report-text" rows="3" cols="40" placeholder="ì˜ˆ: ì¡°ì¹˜ ì™„ë£Œ, ì „ë ¥ ë³µêµ¬ ë“±..."></textarea>
        </label><br>
        <button onclick="reportIssue()">ğŸ“± ë³´ê³  ë“±ë¡</button>
    </div>

    <div class="report-box">
        <h3>ğŸ“ ë¶€ëŒ€ë³„ ì „í™”ë²ˆí˜¸ë¶€</h3>
        <ul id="phonebook-list">
            <li>ë¶€ëŒ€ë¥¼ ì„ íƒí•˜ë©´ ê°„ë¶€ ì—°ë½ì²˜ê°€ í‘œì‹œë©ë‹ˆë‹¤.</li>
        <li><strong>âœï¸ ì•„ë˜ ì…ë ¥ì°½ìœ¼ë¡œ ì´ë¦„/ë²ˆí˜¸ ìˆ˜ì • ê°€ëŠ¥</strong></li></ul>
    
    <div class="report-box">
        <h3>âœï¸ ì „í™”ë²ˆí˜¸ë¶€ ì •ë³´ ìˆ˜ì •</h3>
        <label>ê°„ë¶€ ì´ë¦„: <input type="text" id="edit-name"></label><br>
        <label>ì „í™”ë²ˆí˜¸: <input type="text" id="edit-phone"></label><br>
        <label><input type="checkbox" id="edit-duty"> ë‹¹ì§ì</label><br>
        <button onclick="editPhonebookEntry()">ê°„ë¶€ ì •ë³´ ìˆ˜ì •</button>
    </div>

    <h2>ğŸ“‹ ê´€ì œ ë¡œê·¸</h2>

    <table border="1" width="100%">
        <thead>
            <tr><th>ì‹œê°„</th><th>ë¶€ëŒ€</th><th>ê´€ì œ ì—¬ë¶€ / ë³´ê³ </th></tr>
        </thead>
        <tbody id="log-body"></tbody>
    </table>
</body>
</html>
